<!DOCTYPE html>
<html>
<head>
    <title>Emotion Monitor Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { background: #181b2b; color: #ffe037; font-family: 'Segoe UI', Arial, sans-serif; margin:0; }
        .container { display: flex; min-height:100vh; padding:0; }
        .maincol {
            flex: 2;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 95vh;
        }
        .maincard {
            background: #232735;
            border-radius: 26px;
            box-shadow: 0 0 24px #0008;
            padding: 34px 20px 16px 20px;
            width: 670px;
            margin-top:38px;
            display: flex;
            flex-direction: column;
            align-items:center;
        }
        .maincard h1 {
            color: #ffe037;
            font-size: 2.4em;
            font-weight: bold;
            margin-bottom: 18px;
            text-align:center;
        }
        .videoframe {
            border: 4px solid #24ffd3;
            border-radius: 18px;
            background: #14161e;
            padding: 8px;
            margin:auto;
        }
        .sidecol {
            flex: 1;
            margin-top: 38px;
            margin-right: 50px;
            display: flex;
            flex-direction: column;
            gap:22px;
            min-width: 360px;
            align-items: stretch;
        }
        .card {
            background: #232735;
            color:#ffe037;
            border-radius: 18px;
            box-shadow: 0 6px 20px #0005;
            padding: 18px 22px;
            margin-bottom: 12px;
            display:flex;
            flex-direction:column;
        }
        .card h2 {
            color: #76faf6;
            font-size: 1.08em;
            margin-bottom:10px;
            font-weight:700;
            letter-spacing:.5px;
        }
        .big-num {
            font-size: 2em;
            margin-bottom:4px;
            color:#ffd700;
        }
        .meter { height: 14px; background: #333; border-radius: 7px; margin-top:8px; overflow:hidden; }
        .fill { height:100%; background: #ffd700; }
        .statline { font-size:1em; margin:3px 0;color:#fff8ae; }
        .chartimg { display:block; width:90%; max-width:270px; margin:auto; background:#181b2b; border-radius:6px;}
        a { color:#68ffe7; text-decoration:underline; font-weight:600; }
        .card strong { color: #e5ac3c;}
    </style>
    <script>
    async function refreshCharts(){
        const chart = await fetch('/chart').then(r=>r.json());
        const stats = await fetch('/stats').then(r=>r.json());
        const hist = await fetch('/history_chart').then(r=>r.json());
        if(chart.status==='ok')
            document.getElementById('emotion_chart').src='data:image/png;base64,'+chart.chart;
        if(stats.current_emotion) {
            document.getElementById('current_emotion').innerHTML = stats.current_emotion.toUpperCase();
            document.getElementById('current_conf').innerHTML = stats.confidence + '%';
            document.getElementById('dom_emotion').innerHTML = stats.dominant_emotion.toUpperCase();
            document.getElementById('total_detect').innerHTML = 
                stats.percentages ? Object.values(stats.percentages).reduce((a, b) => a+b, 0).toFixed(0) : '0';
            document.getElementById('meter_fill').style.width = (stats.confidence || 0) + "%";
        }
        if(hist.status==='ok') {
            document.getElementById('history_chart').src='data:image/png;base64,'+hist.chart;
        }
    }
    setInterval(refreshCharts, 2500);
    window.onload=refreshCharts;
    </script>
</head>
<body>
    <div class="container">
        <div class="maincol">
            <div class="maincard">
                <h1>Real-Time Emotion Monitor</h1>
                <img src="{{ url_for('video_feed') }}" width="640" height="480" class="videoframe">
            </div>
        </div>
        <div class="sidecol">
            <div class="card">
                <h2>CURRENT DETECTION</h2>
                <div class="big-num" id="current_emotion">...</div>
                <div id="current_conf" style="font-size:1.1em;color:#90ffbd;">...</div>
                <div class="meter"><div class="fill" id="meter_fill" style="width:0%"></div></div>
            </div>
            <div class="card">
                <h2>SESSION STATISTICS</h2>
                <div class="statline">Total Detections: <strong id="total_detect">0</strong></div>
                <div class="statline">Dominant Emotion: <strong id="dom_emotion">...</strong></div>
                <div class="statline" style="margin-top:10px;">
                    <a href="/detection">Previous Detections</a>
                </div>
            </div>
            <div class="card">
                <h2>REAL-TIME PROBABILITIES</h2>
                <img id="emotion_chart" class="chartimg">
            </div>
            <div class="card">
                <h2>DETECTION HISTORY</h2>
                <img id="history_chart" class="chartimg">
            </div>
        </div>
    </div>
</body>
</html>